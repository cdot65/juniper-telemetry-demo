# {{page_title}}

## Welcome

First off, hello and welcome to the landing page of my demo's documentation. My name is Calvin and I work in the sales organization at Juniper Networks; I hope that you will find this project helpful.

In this demonstration, we will deploy jtimon as a container to ingest JTI telemetry from Juniper vMX routers.

![topology](https://github.com/cdot65/juniper-telemetry-demo/blob/main/files/images/topology.png?raw=true)

## Overview

Let's talk about the workflow before we get into the requirements. 

At the end of this page we will have deployed a Docker container running [jtimon](https://github.com/nileshsimaria/jtimon) to collect the streaming telemetry sent by our routers. We will have subscribed to the telemetry path that will send our container information regarding to BGP over gRPC with SSL encryption.

## Assumptions made on my part

I make a lot of assumptions in this documentation, here's a short list:

  - you have [Docker installed](https://docs.docker.com/get-docker/) somewhere that can reach the internet
  - you understand the [value proposition and technology that powers](https://www.juniper.net/documentation/us/en/software/junos/interfaces-telemetry/topics/concept/junos-telemetry-interface-oveview.html) streaming telemetry
  - you have access to a [Juniper device with JTI installed](https://www.juniper.net/us/en/dm/vmx-trial-download.html)

## Creating our certs

We will be using SSL certificates for this demo, and if you've ever played with SSL you know that it can be a pain. Here are the steps I followed, as given to the readers of [this great blog](https://iosonounrouter.wordpress.com/2021/12/20/test-juniper-telemetry-in-two-seconds/).

Let's start off by generating a self-signed root CA:

```bash
openssl genrsa -out rootCA.key 2048
openssl req -x509 -new -key ./rootCA.key -days 365 -out ./rootCA.crt
```

Our next step is to use the rootCA to create a certificate for the jtimon container client

```bash
openssl genrsa -out ./client.key 2048 
openssl req -new -key ./client.key -out ./client.csr
openssl x509 -req -in ./client.csr -CA ./rootCA.crt -CAkey ./rootCA.key -CAcreateserial -out ./client.crt -days 365
```

Finally, we will use the rootCA to create a certificate for the jtimon container client

> pay close attention to the fqdn for this section, it needs to match your router's hostname

```bash
openssl genrsa -out ./router.key 2048 
openssl req -new -key ./router.key -out ./router.csr
openssl x509 -req -in ./router.csr -CA ./rootCA.crt -CAkey ./rootCA.key -CAcreateserial -out ./router.crt -days 365
cat ./router.crt ./router.key > ./router.pem
```

## Copy relevant certs to router

Let's use SCP to copy the certs to our router; only relevant files are transferred and stored in the router's `/var/tmp/` directory.

```bash
scp rootCA.crt client.crt router.pem root@192.168.110.11:/var/tmp/
```

## Configure JunOS

Three steps here, each with their own commit operation.

1. create CA profile and new local certificate
2. load CA profile and configure streaming attributes
3. enable the streaming of telemetry to our jtimon container

### create CA profile and new local certificate

We will create a new CA profile with the name of `ca-profile-1` and give it an identify of `ca-id-1`.

```junos
set security pki ca-profile ca-profile-1 ca-identity ca-id-1
```

Now we will create a new certificate profile for the router and tell it where it can find the file we transferred.

```junos
set security certificates local router-cert load-key-file /var/tmp/router.pem
```

Give the box your first commit

```junos
commit
```

### load CA profile and configure streaming attributes

Now that the CA profile has been created, we can associate the root CA certificate to it.

```junos
run request security pki ca-certificate load ca-profile ca-profile-1 filename /var/tmp/rootCA.crt
```

Let's set up some basic streaming parameters that will tie together our local router cert and the root CA.

```junos
set system services extension-service request-response grpc ssl port 50051
set system services extension-service request-response grpc ssl local-certificate router-cert
set system services extension-service request-response grpc ssl mutual-authentication certificate-authority ca-id-1
set system services extension-service request-response grpc ssl mutual-authentication client-certificate-request require-certificate-and-verify
```

Give the box your second commit

```junos
commit
```

### enable the streaming of telemetry to our jtimon container

Final step is to configure our source endpoint parameters, in our case this will be the local router's management IP and port to listen for connections on.

```junos
set system services extension-service request-response grpc ssl address 192.168.110.11
set system services extension-service request-response grpc ssl port 32767
set system services extension-service request-response grpc ssl local-certificate router-cert
commit
```

*This page is automatically generated*